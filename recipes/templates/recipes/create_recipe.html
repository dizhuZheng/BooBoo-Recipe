{% include "base.html" %}
{% load static %}
{% load bootstrap4 %}
<body>
  <div class="container">
    <h2>Create a recipe</h2>
    <form method="post" action="" enctype="multipart/form-data">
      {% csrf_token %}
      <table>
        {% bootstrap_form form %}
      </table>
      <div id="ingredients">
        {{ ingredient_formset.management_form }}
        <label>{{ ingredient_formset.prefix }}</label>
        {% for form in ingredient_formset %}
          <form class="form-inline">
            <label for="name">Name:</label>
            <input type="text" class="form-control" id="name">
            <label for="amount">Amount</label>
            <input type="text" class="form-control" id="amount" placeholder="amount" required>
          </form>
        {% endfor %}
      </div>
      <br><br><br>
      <div id="steps">
        {{ step_formset.management_form }}
        <label>{{ step_formset.prefix }}</label>
        {% for form in step_formset %}
        <div class="specific-step">
          <p>{{ form.text }}</p>
          <p>{{ form.pic }}</p>
          <img id="previewHolder" alt="Uploaded Image Preview Holder" width="250px" height="250px"/>
        </div>
        {% endfor %}
      </div>
    <button type="submit" class="btn btn-primary">Submit</button>
  </form>
</body>
<head>
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="{% static 'dynamic_formsets/jquery.formset.js' %}" type="text/javascript"></script>
<script type="text/javascript">
  $('div#ingredients' ).formset({
      prefix: '{{ ingredient_formset.prefix }}',
      addCssClass: "add",
    });
  $('div#steps').formset({
    prefix: '{{ step_formset.prefix }}',
    addCssClass: "add",
    added:"readURL",
  });
  $('#move-up').click(function(){
    var cur_li = $(this).parent();
    var prev_li = cur_li.prev();
        if(prev_li.length != 0){
            prev_li.before(cur_li);
            }
    });
  function readURL(input){
    if (input.files && input.files[0]) {
      var reader = new FileReader();
      reader.onload = function(e) {
        $('#previewHolder').attr('src', e.target.result);}
      reader.readAsDataURL(input.files[0]);}}
  $('#filePhoto').change(function() {
    readURL(this);
  });
  $('#move-up').click(function(){
    var cur_li = $(this).parent();
    var prev_li = cur_li.prev();
        if(prev_li.length != 0){
            prev_li.before(cur_li);
            }
    });
</script>
<style>
  .add{
    font-weight: bold;
    font-size: xx-large;
    border-radius: 12px;
    border: none;
    color: white;
    background-color: yellowgreen;
    padding: 5px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 12px;
    margin: 2px 1px;
    cursor: pointer;
  }
  div#steps{
    counter-reset: my-sec-counter;
  }
  div.specific-step p{
    display: inline;
    margin: 50px;
  }
  div.specific-step::before{
    counter-increment: my-sec-counter;
    content: counter(my-sec-counter) ". ";
  }
  </style>
</head>
