{% load static %}
<div>
  <p> {{ post.updated_on }}</p>
  <h2>{{ post.title }}</h2>
  <div>
    {{ ingredients.count }}
    {% for i in ingredients %}
    <label class="container">
      {{ i.name }}{{ i.amount}}
      {% if i.unit %}
        {{ i.unit }}
      {% endif %}
      <input type="checkbox">
      <span class="checkmark"></span>
    </label>
    {% endfor %}
  </div>
  <div>
    <ul>
      {{ steps.count }}
      {% for step in steps %}
        <li>{{ step.text }}</li>
        {% if step.pic %}
          <li><img src="{{ step.pic.url }}" class="img-responsive" style="width: 20%; float: left; margin-right: 10px;" /></li>
        {% else %}
          <li><img src="/media/images/noimage.jpg" class="img-responsive" style="width: 20%; float: left; margin-right: 10px;" /></li>
        {% endif %}
      {% endfor %}
    </ul>
  </div>
  {% if request.user.is_authenticated %}
    {% ifequal request.user post.author %}
    <a href="{% url 'recipes:delete_post' slug=post.slug %}">Delete Post</a>
    {% endifequal %}
  {% endif %}
  {% ifnotequal request.user post.author %}
    {% if not save_status %}
    <form method="POST" action="{% url 'recipes:post_favorite' slug=post.slug %}">
      {% csrf_token %}
      <input type="hidden" name="supporttype" />
      <input type="submit" value="Save to favorites" name='like'/><i class='fas fa-heart' style='font-size:48px;color:red'></i>
    </form>
    {% endif %}
  {% endifnotequal %}
</div>
<div>
  {% for comment in comments.all %}
    <div>{{ comment.created_on }}</div>
    {% if comment.author.photo %}
      <img src="{{ comment.author.photo.url }}" class="image-preview" width="25" height="25">
    {% else %}
      <img src="{% static "images/default.png" %}" width="25" height="25">
    {% endif %}
    <strong>{{ comment.author }}</strong>
    <p>{{ comment.text|linebreaks }}</p>
    {% ifequal request.user comment.author %}
      <a href="{% url 'recipes:delete_comment' slug=post.slug pk=comment.id %}">Delete comment</a>
    {% endifequal %}
  {% empty %}
      <p>No comments here yet :-(</p>
  {% endfor %}
  <a href="{% url 'recipes:add_comment' slug=post.slug %}">Add comment</a>
  {% if messages %}
  <div class="container">
      {% for message in messages %}
      <div class="alert {% if message.tags %}alert-{{ message.tags }}{% else %}alert-secondary{% endif %} alert-dismissible rounded-0 fade show" role="alert">
          {{ message }}
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span>
          </button>
      </div>
      {% endfor %}
  </div>
{% endif %}
</div>
<script type="text/javascript">
  function changeLike(obj, content_type, object_id){
    var is_like = null;
    $.ajax({
      url: '/like_up',
      type: 'GET',
      data:{
        content_type: content_type,
        object_id: object_id,
        is_like: is_like,
      },
      cache: false,
      success: function (data) {
                console.log(data);
                if (data['status'] == 'SUCCESS'){
                    var record = $(obj.getElementsByClassName('glyphicon'))
                    if (is_like){
                        record.addClass('active')
                    }
                    else {
                        record.removeClass('active')
                    }
                    var like_num = $(obj.getElementsByClassName('like_num'))
                    like_num.text('（' + data['like_num'] + '）')

                }
                else {
                    alert(data['message'])
                }
            },
            error: function (xhr) {
                console.log(xhr)
            }
        });
        return false;
      };
</script>
<style>
  /* The container */
  .container {
    display: block;
    position: relative;
    padding-left: 35px;
    margin-bottom: 12px;
    cursor: pointer;
    font-size: 15px;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }

  /* Hide the browser's default checkbox */
  .container input {
    position: absolute;
    opacity: 0;
    cursor: pointer;
    height: 0;
    width: 0;
  }

  /* Create a custom checkbox */
  .checkmark {
    position: absolute;
    top: 0;
    left: 0;
    height: 25px;
    width: 25px;
    background-color: #eee;
  }

  /* On mouse-over, add a grey background color */
  .container:hover input ~ .checkmark {
    background-color: #ccc;
  }

  /* When the checkbox is checked, add a blue background */
  .container input:checked ~ .checkmark {
    background-color: #2196F3;
  }

  /* Create the checkmark/indicator (hidden when not checked) */
  .checkmark:after {
    content: "";
    position: absolute;
    display: none;
  }

  /* Show the checkmark when checked */
  .container input:checked ~ .checkmark:after {
    display: block;
  }

  /* Style the checkmark/indicator */
  .container .checkmark:after {
    left: 9px;
    top: 5px;
    width: 5px;
    height: 10px;
    border: solid white;
    border-width: 0 3px 3px 0;
    -webkit-transform: rotate(45deg);
    -ms-transform: rotate(45deg);
    transform: rotate(45deg);
  }
  </style>
