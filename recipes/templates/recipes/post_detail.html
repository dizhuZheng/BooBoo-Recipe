{% load static %}
{% load ratings %}
<div>
  <h1>{{ post.title }}</h1>
  <h3>Created by:  <img src="{{ post.author.photo.url }}" class="image-preview" width="25" height="25">
    <a href="{% url 'users:profile' username=post.author.username %}" style="color: goldenrod;">{{ post.author }}</a>
  </h3>
  <p style="text-align: center; " class="sansserif"> Updated at: {{ post.updated_on|date:"D d M Y" }}</p>
  <div class="profile-container">
    {% if steps.last.pic %}
      <img src="{{ steps.last.pic.url }}" width="250" height="250">
    {% else %}
      <img src="/media/images/noimage.jpg" width="200" height="200">
    {% endif %}
    <div>
      <p class="sansserif">Categories: {{ post.categories }}</p>
      <p class="sansserif">Cook Time: {{ post.cook_time }}{{ post.unit }}</p>
      <button class="btn" id="like" value="Good Recipe"><i class="fas fa-thumbs-up"></i><span id="test1">({{ likes }})</span></button>
      <br><br>
      <div class="sansserif">{% ratings object %}</div>
      <br>
      {% if request.user.is_authenticated %}
        {% ifequal request.user post.author %}
        <a href="{% url 'recipes:delete_post' slug=post.slug %}" class="sansserif">Delete Post</a>&nbsp;&nbsp;
        <a href="{% url 'recipes:update_post' slug=post.slug %}" class="sansserif">Update Post</a>
        {% endifequal %}
      {% else %}
      <h4>Please <a href="{% url 'account_login' %}">Log in </a> first</h4>
      {% endif %}
    </div>
  </div>
<div>
  <h4>{{ ingredients.count }} ingredients</h4>
  {% for i in ingredients %}
  <label class="container">
    {{ i.name }}--{{ i.amount}}
    {% if i.unit %}
      {{ i.unit }}
    {% endif %}
    <input type="checkbox">
    <span class="checkmark"></span>
  </label>
  {% endfor %}
</div>
<br>
<h4>Steps:</h4>
{% for step in steps %}
  <div class="steps">
    {% if step.pic %}
      <img src="{{ step.pic.url }}" class="img-responsive" style="width: 20%; float: left;" />
    {% else %}
      <img src="/media/images/noimage.jpg" class="img-responsive" style="width: 20%; float: left;" />
    {% endif %}
    <div id="test">{{ step.text }}</div>
  </div>
{% endfor %}
<div>
  {% ifnotequal request.user post.author %}
    {% if not save_status %}
    <form method="POST" action="{% url 'recipes:post_favorite' slug=post.slug %}">
      <input type="hidden" name="supporttype" />
      <input type="submit" value="Save to favorites" name='like'/>
    </form>
    {% endif %}
  {% endifnotequal %}
</div>
<div>
  {% for comment in comments.all %}
    <div>{{ comment.created_on }}</div>
    <img src="{{ comment.author.photo.url }}" class="image-preview" width="25" height="25">
    <strong>{{ comment.author }}</strong>
    <p>{{ comment.text|linebreaks }}</p>
    {% ifequal request.user comment.author %}
      <a href="{% url 'recipes:delete_comment' slug=post.slug pk=comment.id %}">Delete comment</a>
    {% endifequal %}
  {% empty %}
      <p>No comments here yet :-(</p>
  {% endfor %}
  <a href="{% url 'recipes:add_comment' slug=post.slug %}">Add comment</a>
  {% if messages %}
  <div class="container">
      {% for message in messages %}
      <div class="alert {% if message.tags %}alert-{{ message.tags }}{% else %}alert-secondary{% endif %} alert-dismissible rounded-0 fade show" role="alert">
          {{ message }}
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span>
          </button>
      </div>
      {% endfor %}
  </div>
{% endif %}
</div>
<link rel="stylesheet" href="{% static 'star-ratings/css/star-ratings.css' %}">
<script type="text/javascript" src="{% static 'star-ratings/js/dist/star-ratings.min.js' %}"></script>
<script src='https://kit.fontawesome.com/a076d05399.js'></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){
  $('#like').click(function(){
      $.ajax({
          url:'ajax/',
          type:"post",
          dataType:"json",
          success:function(data){
              $('#test1').html(data.likes)
              alert(data.message)
              $('#1').addClass("fa fa-thumbs-up")
          }
      })
  })
});
</script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
  /* The container */
  .container {
    display: block;
    position: relative;
    padding-left: 35px;
    margin-bottom: 12px;
    cursor: pointer;
    font-size: 15px;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }
  /* Hide the browser's default checkbox */
  .container input {
    position: absolute;
    opacity: 0;
    cursor: pointer;
    height: 0;
    width: 0;
  }

  /* Create a custom checkbox */
  .checkmark {
    position: absolute;
    top: 0;
    left: 0;
    height: 25px;
    width: 25px;
    background-color: #eee;
  }

  /* On mouse-over, add a grey background color */
  .container:hover input ~ .checkmark {
    background-color: #ccc;
  }

  /* When the checkbox is checked, add a blue background */
  .container input:checked ~ .checkmark {
    background-color: #2196F3;
  }

  /* Create the checkmark/indicator (hidden when not checked) */
  .checkmark:after {
    content: "";
    position: absolute;
    display: none;
  }

  /* Show the checkmark when checked */
  .container input:checked ~ .checkmark:after {
    display: block;
  }

  /* Style the checkmark/indicator */
  .container .checkmark:after {
    left: 9px;
    top: 5px;
    width: 5px;
    height: 10px;
    border: solid white;
    border-width: 0 3px 3px 0;
    -webkit-transform: rotate(45deg);
    -ms-transform: rotate(45deg);
    transform: rotate(45deg);
  }
  .steps {
    margin-left: 10px;
    padding-bottom: 30px;
  }
  .steps img{
    margin-left: 10px;
    padding-top: 10px;
    padding-right: 1000px;
    float: left;
  }
  .text{
    height: 200px;
    width: 50%;
    float:right;
  }
  .btn {
  background-color: rgb(86, 104, 163);
  border: none;
  border-radius: 12px;
  color: white;
  padding: 10px 13px;
  font-size: 25px;
  cursor: pointer;
}
h1, h3, h3{
  text-align: center;
}
.sansserif {
  font-family: Arial, Helvetica, sans-serif;
}
.profile-container > img{
  display: block;
  justify-content: center;
  margin-left: auto;
  margin-right: auto;
}
.profile-container > div {
  display: inline-block;
  position: absolute;
  right: 200px;
  margin-top: -250px;
  padding: 5px;
  line-height: 15px;
  font-size: 15px;
  color:mediumspringgreen;
}
</style>
