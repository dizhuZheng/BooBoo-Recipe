{% load static %}
<div>
  <p> {{ post.updated_on }}</p>
  <h2>{{ post.title }}</h2>
  <div>
    {{ ingredients.count }}
    {% for i in ingredients %}
      <b>{{ i.name }}{{ i.amount}}</b>
      {% if i.unit %}
        {{ i.unit }}
      {% endif %}
    {% endfor %}
  </div>
  <div>
    <ul>
      {{ steps.count }}
      {% for step in steps %}
        <li>{{ step.text }}</li>
        {% if step.pic %}
          <li><img src="{{ step.pic.url }}" class="img-responsive" style="width: 20%; float: left; margin-right: 10px;" /></li>
        {% else %}
          <li><img src="/media/images/noimage.jpg" class="img-responsive" style="width: 20%; float: left; margin-right: 10px;" /></li>
        {% endif %}
      {% endfor %}
    </ul>
  </div>
  {% if request.user.is_authenticated %}
    {% ifequal request.user post.author %}
    <a href="{% url 'recipes:delete_post' slug=post.slug %}">Delete Post</a>
    {% endifequal %}
  {% endif %}
  {% ifnotequal request.user post.author %}
  <form method="POST" action="{% url 'recipes:post_favorite' slug=post.slug %}">
    {% csrf_token %}
    <input type="hidden" name="supporttype" />
    <input type="submit" value="Save to My Favorites" />
  </form>
  {% endifnotequal %}
</div>
<div>
  {% for comment in comments.all %}
    <div>{{ comment.created_on }}</div>
    {% if comment.author.photo %}
      <img src="{{ comment.author.photo.url }}" class="image-preview" width="25" height="25">
    {% else %}
      <img src="{% static "images/default.png" %}" width="25" height="25">
    {% endif %}
    <strong>{{ comment.author }}</strong>
    <p>{{ comment.text|linebreaks }}</p>
    {% ifequal request.user comment.author %}
      <a href="{% url 'recipes:delete_comment' slug=post.slug pk=comment.id %}">Delete comment</a>
    {% endifequal %}
  {% empty %}
      <p>No comments here yet :-(</p>
  {% endfor %}
  <a href="{% url 'recipes:add_comment' slug=post.slug %}">Add comment</a>
  {% if messages %}
  <div class="container">
      {% for message in messages %}
      <div class="alert {% if message.tags %}alert-{{ message.tags }}{% else %}alert-secondary{% endif %} alert-dismissible rounded-0 fade show" role="alert">
          {{ message }}
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span>
          </button>
      </div>
      {% endfor %}
  </div>
{% endif %}
</div>
<script type="text/javascript">
  function getCookie(name){
    var cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = jQuery.trim(cookies[i]);
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;}}}
    return cookieValue;}
  var csrftoken = getCookie('csrftoken');
  function csrfSafeMethod(method) {
      return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
  }
  $.ajaxSetup({
      beforeSend: function(xhr, settings) {
          if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
              xhr.setRequestHeader("X-CSRFToken", csrftoken);
          }
      }
  });
</script>
