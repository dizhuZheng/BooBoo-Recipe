{% extends 'recipes/base.html' %}
{% load static %}
{% load ratings %}
{% if messages %}
  {% block m %}
      {% for message in messages %}
      <div class="alert {% if message.tags %}alert-{{ message.tags }}{% else %}alert-secondary{% endif %} alert-dismissible rounded-0 fade show" role="alert">
          {{ message }}
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span>
          </button>
      </div>
      {% endfor %}
  {% endblock m %}
{% endif %}
{% block content %}
<div class="container" style="margin-top: 6%; margin-bottom: 10%; margin-left: 5%;">
  <div class="row">
    <div class="col-sm-3" style="background-color:lavender; padding: 20px;">
      <h1>{{ post.title }}</h1>
      <h3>Author:  <img src="{{ post.author.photo.url }}" class="image-preview" width="25" height="25">
        <a href="{% url 'users:profile' username=post.author.username %}" style="color: goldenrod;">{{ post.author }}</a>
      </h3>
      <p> Updated at: {{ post.updated_on|date:"D d M Y" }}</p>
      {% if steps.last.pic %}
        <img src="{{ steps.last.pic.url }}" width="250" height="250">
      {% else %}
        <img src="/media/images/noimage.jpg" width="200" height="200">
      {% endif %}
    </div>
    <div class="col-sm-3" style="background-color:lavenderblush;padding: 50px;">
      <div style="font-family: fantasy;">
        <p>Categories: {{ post.category.name }}</p>
        <p>Cook Time: {{ post.cook_time }}{{ post.unit }}</p>
        <p>Likes: <button class="btn" id="like" value="Good Recipe"><i class="fas fa-thumbs-up"></i><span id="test1">{{ likes }}</span></button></p>
        <p>Difficulty level:</p>
        <p>{% ratings object %}</p>
        <div>
          {% ifnotequal request.user post.author %}
            {% if not save_status %}
            <form method="POST" action="{% url 'recipes:post_favorite' slug=post.slug %}">
              <input type="hidden" name="supporttype" />
              <input type="submit" value="Save to favorites" name='like'/>
            </form>
            {% endif %}
          {% endifnotequal %}
        </div>
      </div>
    </div>
  </div>
  <div>
    <h2>{{ ingredients.count }} ingredients</h2>
    {% for i in ingredients %}
    <label class="c">
      {{ i.name }}--{{ i.amount}}
      {% if i.unit %}
        {{ i.unit }}
      {% endif %}
      <input type="checkbox">
      <span class="checkmark"></span>
    </label>
    {% endfor %}
  </div>
  <h2>Steps:</h2>
  {% for step in steps %}
    <div class="steps">
      {% if step.pic %}
        <img src="{{ step.pic.url }}" class="img-responsive" style="width: 20%; float: left;" />
      {% else %}
        <img src="/media/images/noimage.jpg" class="img-responsive" style="width: 20%; float: left;" />
      {% endif %}
      <ol><li>{{ step.text }}</li></ol>
    </div>
  {% endfor %}
<div>
  <h2>Comments:</h2>
  {% for comment in comments.all %}
    <div>{{ comment.created_on }}</div>
    <img src="{{ comment.author.photo.url }}" class="image-preview" width="25" height="25">
    <strong>{{ comment.author }}</strong>
    <p class="solid">{{ comment.text|linebreaks }}</p>
    {% ifequal request.user comment.author %}
      <button><a href="{% url 'recipes:delete_comment' slug=post.slug pk=comment.id %}">Delete comment</a></button>
    {% endifequal %}
  {% empty %}
      <p>No comments here yet :-(</p>
  {% endfor %}
  <button><a href="{% url 'recipes:add_comment' slug=post.slug %}">Add comment</a></button>
</div>
</div>
<link rel="stylesheet" href="{% static 'star-ratings/css/star-ratings.css' %}">
<script type="text/javascript" src="{% static 'star-ratings/js/dist/star-ratings.min.js' %}"></script>
<script src='https://kit.fontawesome.com/a076d05399.js'></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>
  $(document).ready(function(){
    $('.toast').toast('show');
  });
</script>
<script type="text/javascript">
$(document).ready(function(){
  $('#like').click(function(){
      $.ajax({
          url:'ajax/',
          type:"post",
          dataType:"json",
          success:function(data){
              $('#test1').html(data.likes)
              alert(data.message)
              $('#1').addClass("fa fa-thumbs-up")
          }
      })
  })
});
</script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
  /* Create a custom checkbox */
  .checkmark {
    position: absolute;
    top: 0;
    left: 0;
    height: 25px;
    width: 25px;
    background-color: #eee;
  }

  /* On mouse-over, add a grey background color */
  .c:hover input ~ .checkmark {
    background-color: #ccc;
  }

  /* When the checkbox is checked, add a blue background */
  .c input:checked ~ .checkmark {
    background-color: #2196F3;
  }
  /* Create the checkmark/indicator (hidden when not checked) */
  .checkmark:after {
    content: "";
    position: absolute;
    display: none;
  }
  /* Show the checkmark when checked */
  .c input:checked ~ .checkmark:after {
    display: block;
  }
  /* Style the checkmark/indicator */
  .c .checkmark:after {
    left: 9px;
    top: 5px;
    width: 5px;
    height: 10px;
    border: solid white;
    border-width: 0 3px 3px 0;
    -webkit-transform: rotate(45deg);
    -ms-transform: rotate(45deg);
    transform: rotate(45deg);
  }
  .container .steps {
    margin-left: 10px;
    padding-bottom: 300px;
  }
  .btn {
  background-color: rgb(86, 104, 163);
  border: none;
  color: white;
  padding: 5px 7px;
  font-size: 15px;
  cursor: pointer;
}
h1, h3, p{
  text-align: center;
}
.profile-container > img{
  display: block;
  justify-content: center;
  margin-left: auto;
  margin-right: auto;
}
.profile-container > div {
  display: inline-block;
  position: absolute;
  right: 10%;
  top: 15%;
  float: right;
  line-height: 15px;
  font-size: 15px;
}
p.solid {border-style: solid;}
</style>
{% endblock content %}
